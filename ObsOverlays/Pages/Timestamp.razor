@page "/timestamp"
@inject NavigationManager NavigationManager

<PageTitle>OBS Browser Source Overlays</PageTitle>

<div class="ms-3 mt-3 mb-5">
    <h1>OBS Browser Source Overlays</h1>
</div>

<div class="ms-5 container ms-auto">
    <div class="row">
        <div class="col-2 d-flex justify-content-center">
            <h6>Timestamp</h6>
        </div>
        <div class="col-2 d-flex justify-content-center">
            <h6>Placeholder</h6>
        </div>
        <div class="col-2 d-flex justify-content-center">
            <h6>Placeholder</h6>
        </div>
        <div class="col-2 d-flex justify-content-center">
            <h6>Placeholder</h6>
        </div>
        <div class="col-2 d-flex justify-content-center">
            <h6>Placeholder</h6>
        </div>
        <div class="col-2 d-flex justify-content-center">
            <h6>Placeholder</h6>
        </div>
    </div>
    <hr class="my-0" />
</div>

<div class="p-4 vh-80">
    <div class="d-flex flex-column flex-grow-1 h-100 justify-content-center">
        <div class="mx-auto">
            <div>
                <h3>Timestamp</h3>
            </div>
            <div>
                <div class="mx-1 mt-1">
                    <label class="col-form-label col-form-label-sm">Title</label>
                    <input @bind-value="Title" class="form-control form-control-sm" type="text" placeholder="Title">
                </div>
            </div>
            <div class="d-flex justify-content-center">
                <div class="mx-1 mt-1">
                    <label class="col-form-label col-form-label-sm">Hours</label>
                    <input @bind-value="Hours" class="form-control form-control-sm" type="text" placeholder="Hours">
                </div>
                <div class="mx-1 mt-1">
                    <label class="col-form-label col-form-label-sm">Minutes</label>
                    <input @bind-value="Minutes" class="form-control form-control-sm" type="text" placeholder="Minutes">
                </div>
                <div class="mx-1 mt-1">
                    <label class="col-form-label col-form-label-sm">Seconds</label>
                    <input @bind-value="Seconds" class="form-control form-control-sm" type="text" placeholder="Seconds">
                </div>
            </div>
            <div class="mx-1 mt-4 pt-1 w-100">
                <button @onclick="OnUpdate" type="button" class="btn btn-success w-100">Update</button>
            </div>
        </div>
        <div class="mt-5">
            <div class="container">
                <div class="row mt-1 white-shadow">
                    <div class="col-4 d-flex justify-content-center">
                        <h3>@((MarkupString)Text)</h3>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h4>@((MarkupString)Text)</h4>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h5>@((MarkupString)Text)</h5>
                    </div>
                </div>
                <div class="row mt-1 dark-shadow">
                    <div class="col-4 d-flex justify-content-center">
                        <h3>@((MarkupString)Text)</h3>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h4>@((MarkupString)Text)</h4>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h5>@((MarkupString)Text)</h5>
                    </div>
                </div>
                <div class="row mt-1 red1-shadow">
                    <div class="col-4 d-flex justify-content-center">
                        <h3>@((MarkupString)Text)</h3>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h4>@((MarkupString)Text)</h4>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h5>@((MarkupString)Text)</h5>
                    </div>
                </div>
                <div class="row mt-1 red2-shadow">
                    <div class="col-4 d-flex justify-content-center">
                        <h3>@((MarkupString)Text)</h3>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h4>@((MarkupString)Text)</h4>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h5>@((MarkupString)Text)</h5>
                    </div>
                </div>
                <div class="row mt-1 green1-shadow">
                    <div class="col-4 d-flex justify-content-center">
                        <h3>@((MarkupString)Text)</h3>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h4>@((MarkupString)Text)</h4>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h5>@((MarkupString)Text)</h5>
                    </div>
                </div>
                <div class="row mt-1 green2-shadow">
                    <div class="col-4 d-flex justify-content-center">
                        <h3>@((MarkupString)Text)</h3>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h4>@((MarkupString)Text)</h4>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h5>@((MarkupString)Text)</h5>
                    </div>
                </div>
                <div class="row mt-1 blue1-shadow">
                    <div class="col-4 d-flex justify-content-center">
                        <h3>@((MarkupString)Text)</h3>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h4>@((MarkupString)Text)</h4>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h5>@((MarkupString)Text)</h5>
                    </div>
                </div>
                <div class="row mt-1 blue2-shadow">
                    <div class="col-4 d-flex justify-content-center">
                        <h3>@((MarkupString)Text)</h3>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h4>@((MarkupString)Text)</h4>
                    </div>
                    <div class="col-4 d-flex justify-content-center">
                        <h5>@((MarkupString)Text)</h5>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private DateTimeOffset? _startTimestamp = DateTimeOffset.UtcNow;

    public string Title { get; set; } = "Some title - ";
    public string Hours { get; set; } = "1";
    public string Minutes { get; set; } = "2";
    public string Seconds { get; set; } = "3";
    public string Text { get; set; }

    public Timestamp()
    {
        Task.Run(Refresh);
    }

    public async Task OnUpdate(MouseEventArgs mouseEventArgs)
    {
        int.TryParse(Hours, out var hours);
        int.TryParse(Minutes, out var minutes);
        int.TryParse(Seconds, out var seconds);
        _startTimestamp = DateTimeOffset.UtcNow.AddHours(-hours).AddMinutes(-minutes).AddSeconds(-seconds);
    }

    private async Task Refresh()
    {
        await OnUpdate(null);
        while (true)
        {
            await Task.Delay(100);

            var difference = (DateTimeOffset.UtcNow - _startTimestamp).Value;
            Text = $"{Title.Replace(" ", "&nbsp;")}{(((int)difference.TotalHours).ToString("D2"))} : {difference.Minutes:D2} : {difference.Seconds:D2}";
            StateHasChanged();
        }
    }
}
